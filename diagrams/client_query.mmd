sequenceDiagram
    actor C as Client


    Box Server
    participant Listener
    participant Stream as ClientStream

    participant CL as ClusterActor
    participant CA as CacheActor
    
    end
    
    
    loop wait for connection
        activate Listener
        C ->> Listener: Connect
        Listener --) Stream : Create
        deactivate Listener
    end

    loop 
        Stream --)+ Stream: wait & receive request
        alt Write Request
            Stream -->> CL: route request
            activate CL
            CL -->> CL : Register callback, wait for concensus
            CL -->> CL : Consensus reached
            deactivate CL
            CL -->> CA : pass request
        else read request
            Stream -->> CA: route request
        end
        CA -->> Stream: return respons
        Stream -->> C: return response
    
    end

    
    